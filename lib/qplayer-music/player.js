(function(f){var e=false,d=true,y=[],w,p,u,m=localStorage.qplayer==undefined?true:false,g=localStorage.qplayer==undefined?false:localStorage.qplayer==="true"?true:false;for(var A=0;A<playlist.length;A++){var D=playlist[A];f("#playlist").append('<li class="lib" style="overflow:hidden;"><strong style="margin-left: 5px;">'+D.title+'</strong><span style="float: right;" class="artist">'+D.artist+"</span></li>");if(D.mp3==""){f("#playlist li").eq(A).css("color","#ddd")}}var q=localStorage.song,H,t;var l=localStorage.qplayer_shuffle_array;if(g&&l!=undefined&&playlist.length===(y=JSON.parse(l)).length){w=0;if(q==undefined){q=y[0];f("#QPlayer .cover").attr("title","点击关闭随机播放")}}else{g=false;f("#QPlayer .cover").attr("title","点击开启随机播放")}var G=0;for(var A=0;A<playlist.length;A++){G+=(f("#playlist li").eq(A).height()+6)}if(G>360){f("#playlist").css("overflow","auto");if(g){var E=0;for(var z=0;z<q;z++){E+=(f("#playlist li").eq(z).height()+6)}f("#playlist").scrollTop(E)}}var C=function(){sessionStorage.autoPlay="true";H.play();if(isRotate){f("#player .cover img").css("animation","9.8s linear 0s normal none infinite rotate");f("#player .cover img").css("animation-play-state","running")}f(".playback").addClass("playing");t=setInterval(s,500);if(isExceedTag()){if(d){initMarquee();d=false}else{f(".marquee").marquee("resume")}}};var k=function(){H.pause();f("#player .cover img").css("animation-play-state","paused");f(".playback").removeClass("playing");clearInterval(t);if(isExceedTag()){f(".marquee").marquee("pause")}sessionStorage.autoPlay=""};var v=function(j){var I=parseInt(j%60)<10?"0"+parseInt(j%60):parseInt(j%60),i=j/H.duration*100;f(".timer").html(parseInt(j/60)+":"+I);localStorage.time=j;localStorage.song=q};var s=function(){v(H.currentTime)};var F=function(j){if(j<0){track=q=playlist.length-1}else{if(j>=playlist.length){track=q=0}else{track=j}}d=true;f("audio").remove();x(track);C()};var n=function(j){if(j===1){if(++w===y.length){w=0}q=y[w]}else{if(j===0){if(--w<0){w=y.length-1}q=y[w]}}F(q)};var h=function(){k();H.currentTime=0;if(g){n(1)}else{if(q<playlist.length){F(++q)}}};var o=function(){var i=this.seekable&&this.seekable.length?this.seekable.end(0):0};var r=function(){if(autoplay==true){C()}};var x=function(I){if(I>playlist.length){I=0}var J=playlist[I];while(J.mp3==""){showNotification("歌曲地址为空，已自动跳过");if(g){if(++w===y.length){w=0}I=q=y[w]}else{q=++I}J=playlist[I]}var j=f("<audio>").html('<source src="'+J.mp3+'"><source src="'+J.ogg+'">').appendTo("#player");f(".cover").html('<img src="'+J.cover+'" alt="'+J.album+'">');f(".musicTag").html("<strong>"+J.title+'</strong><span> - </span><span class="artist">'+J.artist+"</span>");f("#playlist li").removeClass("playing").eq(I).addClass("playing");H=j[0];H.addEventListener("progress",o,false);H.addEventListener("durationchange",o,false);H.addEventListener("canplay",r,false);H.addEventListener("ended",h,false)};var c=function(j,I){if(j==undefined){j=0;q=0;w=0}x(j);if(I){H.currentTime=I}if(sessionStorage.autoPlay==undefined){sessionStorage.autoPlay="false"}};c(q,localStorage.time);if(sessionStorage.autoPlay=="true"){C()}f(".rewind").on("click",function(){if(g){n(0)}else{F(--q)}});f(".fastforward").on("click",function(){if(g){n(1)}else{F(++q)}});f(".playback").on("click",function(){if(f(this).hasClass("playing")){k()}else{C()}});f("#playlist li").each(function(j){f(this).on("click",function(){if(g){for(var i=0;i<y.length;i++){if(y[i]===j){w=i;break}}}else{q=j}F(j)})});f("#QPlayer .liebiao,#QPlayer .liebiao").on("click",function(){var i=f("#playlist");if(i.hasClass("go")===false){i.css({"max-height":"360px",transition:"max-height .5s ease"});i.css("border","1px solid #dedede");i.addClass("go")}else{i.css({"max-height":"0px",transition:"max-height .5s ease"});i.css("border","0");i.removeClass("go")}});f("#QPlayer .ssBtn").on("click",function(){var i=f("#QPlayer");if(f(".ssBtn .adf").hasClass("on")===false){if(m){setTimeout("showTips('#player .cover','点击封面开启(关闭)随机播放', "+function(){setTimeout("showTips('#player .ctrl .musicTag','点击拖动标题栏快进(快退)')",1000)}+");",500);m=!m;localStorage.qplayer="false"}i.css("transform","translateX(250px)");f(".ssBtn .adf").addClass("on");f(".ssBtn .adf .icon-back").show().css("display","block");f(".ssBtn .adf .icon-music").hide()}else{i.css("transform","translateX(0px)");f(".ssBtn .adf").removeClass("on");f(".ssBtn .adf .icon-music").show();f(".ssBtn .adf .icon-back").hide()}});f("#player .cover").on("click",function(){g=!g;if(g){f("#player .cover").attr("title","点击关闭随机播放");showNotification("已开启随机播放");var I=[];for(var K=0;K<playlist.length;K++){I[K]=K}y=shuffle(I);for(var J=0;J<y.length;J++){if(y[J]===q){w=J;break}}localStorage.qplayer_shuffle_array=JSON.stringify(y)}else{f("#player .cover").attr("title","点击开启随机播放");showNotification("已关闭随机播放");localStorage.removeItem("qplayer_shuffle_array")}localStorage.qplayer=g});var B,b;f("#player .ctrl .musicTag").mousedown(function(i){B=i.screenX}).mousemove(function(j){if(j.which===1){b=j.screenX;var i=Math.round((b-B)/678*100);H.currentTime+=i;v(H.currentTime)}});f("#player .ctrl .musicTag").bind("touchstart",function(i){B=i.originalEvent.targetTouches[0].screenX}).bind("touchmove",function(j){b=j.originalEvent.targetTouches[0].screenX;var i=Math.round((b-B)/678*100);H.currentTime+=i;v(H.currentTime)});var a=f(".lib");for(var A=0;A<a.length;A+=2){a[A].style.background="rgba(246, 246, 246, 0.5)"}})(jQuery);function initMarquee(){$(".marquee").marquee({duration:15000,gap:50,delayBeforeStart:0,direction:"left",duplicated:true})}function isExceedTag(){var a=false;if($(".musicTag strong").width()+$(".musicTag span").width()+$(".musicTag .artist").width()>$(".musicTag").width()){a=true}return a}function shuffle(d){var a=d.length,c,b;while(a){b=Math.floor(Math.random()*a--);c=d[a];d[a]=d[b];d[b]=c}return d}function showNotification(b){isShowNotification=true;if($(".qplayer-notification").length>0){$(".qplayer-notification").remove();clearTimeout(autoClearTimer);clearTimeout(autoShowTimer)}$("body").append('<div class="qplayer-notification animation-target"><span class="qplayer-notification-icon">i</span><span class="body" style="box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 5px;"><span class="message"></span></span><a class="close" href="#" onclick="closeNotification();return false;">×</a><div style="clear: both"></div>');$(".qplayer-notification .message").text(b);var a=$(".qplayer-notification").css({opacity:"0",width:"auto"}).width()+20;$(".qplayer-notification").css({width:"50px",opacity:"1"});autoShowTimer=setTimeout(function(){$(".qplayer-notification").css({width:a,transition:"all .7s ease"});$(".qplayer-notification .close").delay(500).show(0)},1500);autoClearTimer=setTimeout("if ($('.qplayer-notification').length>0) {closeNotification()}",8000)}function closeNotification(){isShowNotification=false;$(".qplayer-notification").css({width:"50px",transition:"all .7s ease"});$(".qplayer-notification .close").delay(500).hide(0);setTimeout(function(){if(!isShowNotification){$(".qplayer-notification").css("opacity","0");$(".qplayer-notification-icon").css({transform:"scale(0)",transition:"transform .5s ease"})}},1000);setTimeout(function(){if(!isShowNotification){$(".qplayer-notification").remove()}},1500);clearTimeout(autoClearTimer);clearTimeout(autoShowTimer)}function showTips(d,c,a){var b=100;$("body").append('<div class="qplayer_tips"><span class="tips_arrow"></span><span class="info" style="display:none">'+c+'</span><button class="tips_button" onclick="removeTips()">不再提示</button></div>');$(".qplayer_tips").css({top:$(d).offset().top-b-30-15,left:$(d).offset().left-28});$(".qplayer_tips").css({height:b,transition:"all .5s ease-in-out"});$(".qplayer_tips .info").delay(500).fadeIn();$(".tips_arrow").css({"border-width":"15px",transition:"all .5s ease-in-out"});$(".tips_button").css({height:"30px",transition:"all .5s ease-in-out"});if(a!=undefined){$(".tips_button").click(a)}}function removeTips(){$(".qplayer_tips .info").fadeOut();$(".qplayer_tips").css({height:"0",transition:"all .5s ease-in-out"});$(".tips_arrow").css({"border-width":"0",transition:"all .5s ease-in-out"});$(".tips_button").css({opacity:"0",transition:"all .2s ease-in-out"});setTimeout(function(){$(".qplayer_tips").remove()},500)};