(function(d){var c=false,b=true,w=[],u,n,s,k=localStorage.qplayer==undefined?true:false,e=localStorage.qplayer==undefined?false:localStorage.qplayer==="true"?true:false;for(var y=0;y<playlist.length;y++){var B=playlist[y];d("#playlist").append('<li class="lib" style="overflow:hidden;"><strong style="margin-left: 5px;">'+B.title+'</strong><span style="float: right;" class="artist">'+B.artist+"</span></li>");if(B.mp3==""){d("#playlist li").eq(y).css("color","#ddd")}}var o=0,F,r;var h=localStorage.qplayer_shuffle_array;if(e&&h!=undefined&&playlist.length===(w=JSON.parse(h)).length){o=w[0];u=0;d("#QPlayer .cover").attr("title","点击关闭随机播放")}else{e=false;d("#QPlayer .cover").attr("title","点击开启随机播放")}var E=0;for(var y=0;y<playlist.length;y++){E+=(d("#playlist li").eq(y).height()+6)}if(E>360){d("#playlist").css("overflow","auto");if(e){var C=0;for(var x=0;x<o;x++){C+=(d("#playlist li").eq(x).height()+6)}d("#playlist").scrollTop(C)}}var A=function(){F.play();if(isRotate){d("#player .cover img").css("animation","9.8s linear 0s normal none infinite rotate");d("#player .cover img").css("animation-play-state","running")}d(".playback").addClass("playing");r=setInterval(q,500);if(isExceedTag()){if(b){initMarquee();b=false}else{d(".marquee").marquee("resume")}}};var g=function(){F.pause();d("#player .cover img").css("animation-play-state","paused");d(".playback").removeClass("playing");clearInterval(r);if(isExceedTag()){d(".marquee").marquee("pause")}};var t=function(j){var G=parseInt(j%60)<10?"0"+parseInt(j%60):parseInt(j%60),i=j/F.duration*100;d(".timer").html(parseInt(j/60)+":"+G)};var q=function(){t(F.currentTime)};var D=function(j){if(j<0){track=o=playlist.length-1}else{if(j>=playlist.length){track=o=0}else{track=j}}b=true;d("audio").remove();v(track);A()};var l=function(j){if(j===1){if(++u===w.length){u=0}o=w[u]}else{if(j===0){if(--u<0){u=w.length-1}o=w[u]}}D(o)};var f=function(){g();F.currentTime=0;if(e){l(1)}else{if(o<playlist.length){D(++o)}}};var m=function(){var i=this.seekable&&this.seekable.length?this.seekable.end(0):0};var p=function(){if(autoplay==true){A()}};var v=function(G){var H=playlist[G];while(H.mp3==""){showNotification("歌曲地址为空，已自动跳过");if(e){if(++u===w.length){u=0}G=o=w[u]}else{o=++G}H=playlist[G]}var j=d("<audio>").html('<source src="'+H.mp3+'"><source src="'+H.ogg+'">').appendTo("#player");d(".cover").html('<img src="'+H.cover+'" alt="'+H.album+'">');d(".musicTag").html("<strong>"+H.title+'</strong><span> - </span><span class="artist">'+H.artist+"</span>");d("#playlist li").removeClass("playing").eq(G).addClass("playing");F=j[0];F.addEventListener("progress",m,false);F.addEventListener("durationchange",m,false);F.addEventListener("canplay",p,false);F.addEventListener("ended",f,false)};v(o);d(".playback").on("click",function(){if(d(this).hasClass("playing")){g()}else{A()}});d(".rewind").on("click",function(){if(e){l(0)}else{D(--o)}});d(".fastforward").on("click",function(){if(e){l(1)}else{D(++o)}});d("#playlist li").each(function(j){d(this).on("click",function(){if(e){for(var i=0;i<w.length;i++){if(w[i]===j){u=i;break}}}else{o=j}D(j)})});d("#QPlayer .liebiao,#QPlayer .liebiao").on("click",function(){var i=d("#playlist");if(i.hasClass("go")===false){i.css({"max-height":"360px",transition:"max-height .5s ease"});i.css("border","1px solid #dedede");i.addClass("go")}else{i.css({"max-height":"0px",transition:"max-height .5s ease"});i.css("border","0");i.removeClass("go")}});d("#QPlayer .ssBtn").on("click",function(){var i=d("#QPlayer");if(d(".ssBtn .adf").hasClass("on")===false){if(k){setTimeout("showTips('#player .cover','点击封面开启(关闭)随机播放', "+function(){setTimeout("showTips('#player .ctrl .musicTag','点击拖动标题栏快进(快退)')",1000)}+");",500);k=!k;localStorage.qplayer="false"}i.css("transform","translateX(250px)");d(".ssBtn .adf").addClass("on");d(".ssBtn .adf .icon-back").fadeIn().css("display","block");d(".ssBtn .adf .icon-music").hide()}else{i.css("transform","translateX(0px)");d(".ssBtn .adf").removeClass("on");d(".ssBtn .adf .icon-music").show();d(".ssBtn .adf .icon-back").hide()}});d("#player .cover").on("click",function(){e=!e;if(e){d("#player .cover").attr("title","点击关闭随机播放");showNotification("已开启随机播放");var G=[];for(var I=0;I<playlist.length;I++){G[I]=I}w=shuffle(G);for(var H=0;H<w.length;H++){if(w[H]===o){u=H;break}}localStorage.qplayer_shuffle_array=JSON.stringify(w)}else{d("#player .cover").attr("title","点击开启随机播放");showNotification("已关闭随机播放");localStorage.removeItem("qplayer_shuffle_array")}localStorage.qplayer=e});var z,a;d("#player .ctrl .musicTag").mousedown(function(i){z=i.screenX}).mousemove(function(j){if(j.which===1){a=j.screenX;var i=Math.round((a-z)/678*100);F.currentTime+=i;t(F.currentTime)}});d("#player .ctrl .musicTag").bind("touchstart",function(i){z=i.originalEvent.targetTouches[0].screenX}).bind("touchmove",function(j){a=j.originalEvent.targetTouches[0].screenX;var i=Math.round((a-z)/678*100);F.currentTime+=i;t(F.currentTime)})})(jQuery);function initMarquee(){$(".marquee").marquee({duration:15000,gap:50,delayBeforeStart:0,direction:"left",duplicated:true})}function isExceedTag(){var a=false;if($(".musicTag strong").width()+$(".musicTag span").width()+$(".musicTag .artist").width()>$(".musicTag").width()){a=true}return a}function shuffle(d){var a=d.length,c,b;while(a){b=Math.floor(Math.random()*a--);c=d[a];d[a]=d[b];d[b]=c}return d}function showNotification(b){isShowNotification=true;if($(".qplayer-notification").length>0){$(".qplayer-notification").remove();clearTimeout(autoClearTimer);clearTimeout(autoShowTimer)}$("body").append('<div class="qplayer-notification animation-target"><span class="qplayer-notification-icon">i</span><span class="body" style="box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 5px;"><span class="message"></span></span><a class="close" href="#" onclick="closeNotification();return false;">×</a><div style="clear: both"></div>');$(".qplayer-notification .message").text(b);var a=$(".qplayer-notification").css({opacity:"0",width:"auto"}).width()+20;$(".qplayer-notification").css({width:"50px",opacity:"1"});autoShowTimer=setTimeout(function(){$(".qplayer-notification").css({width:a,transition:"all .7s ease"});$(".qplayer-notification .close").delay(500).show(0)},1500);autoClearTimer=setTimeout("if ($('.qplayer-notification').length>0) {closeNotification()}",8000)}function closeNotification(){isShowNotification=false;$(".qplayer-notification").css({width:"50px",transition:"all .7s ease"});$(".qplayer-notification .close").delay(500).hide(0);setTimeout(function(){if(!isShowNotification){$(".qplayer-notification").css("opacity","0");$(".qplayer-notification-icon").css({transform:"scale(0)",transition:"transform .5s ease"})}},1000);setTimeout(function(){if(!isShowNotification){$(".qplayer-notification").remove()}},1500);clearTimeout(autoClearTimer);clearTimeout(autoShowTimer)}function showTips(d,c,a){var b=100;$("body").append('<div class="qplayer_tips"><span class="tips_arrow"></span><span class="info" style="display:none">'+c+'</span><button class="tips_button" onclick="removeTips()">不再提示</button></div>');$(".qplayer_tips").css({top:$(d).offset().top-b-30-15,left:$(d).offset().left-28});$(".qplayer_tips").css({height:b,transition:"all .5s ease-in-out"});$(".qplayer_tips .info").delay(500).fadeIn();$(".tips_arrow").css({"border-width":"15px",transition:"all .5s ease-in-out"});$(".tips_button").css({height:"30px",transition:"all .5s ease-in-out"});if(a!=undefined){$(".tips_button").click(a)}}function removeTips(){$(".qplayer_tips .info").fadeOut();$(".qplayer_tips").css({height:"0",transition:"all .5s ease-in-out"});$(".tips_arrow").css({"border-width":"0",transition:"all .5s ease-in-out"});$(".tips_button").css({opacity:"0",transition:"all .2s ease-in-out"});setTimeout(function(){$(".qplayer_tips").remove()},500)};function bgChange(){var a=$(".lib");for(var b=0;b<a.length;b+=2){a[b].style.background="rgba(246, 246, 246, 0.5)"}}window.onload=bgChange;